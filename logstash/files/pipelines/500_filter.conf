filter {
    ruby {
        code =>'
            insights = event.get("[Insights]")

            if insights
                tmp = insights.to_hash
                if tmp.size == 1
                    key, val = tmp.first
                    event.set("[Insights][Parsed]", event.get("[Insights][#{key}]"))
                    event.set("[Insights][Ident]", key)
                    event.remove("[Insights][#{key}]")
                end
            end
            putsevent.to_json.length
        '
    }
    mutate {
        remove_field => [ "@timestamp", "host", "path", "@version" ]
    }
}